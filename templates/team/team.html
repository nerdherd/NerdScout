{% extends 'base.html' %}

{% block head %}
<!-- <script src="{{ url_for('static', filename='javascript/match.js') }}" defer></script>
<link rel="stylesheet" href="{{ url_for('static', filename='stylesheets/match.css') }}"> -->
<link rel="preload" href="{{ url_for('static', filename='stylesheets/team.css') }}" as="style">
<link rel="stylesheet" href="{{ url_for('static',filename='stylesheets/team.css') }}">
{% endblock %}

{% block title %}Team {{ team["number"] }} - {{ team["shortName"] }}{% endblock %}

{% block content %}
<div class="card">
<h1>Team {{ team["number"] }}</h1>

<h2>{{ team["shortName"] }}</h2>
<p>{{ team["longName"] }}</p>

</div>

{% if team["images"] %}
<div id="teamImagesContainer">
        <div id="leftArrow" class="imageNav" onclick="changeImage(false)">&#xe5c4</div>
        <div id="rightArrow" class="imageNav" onclick="changeImage(true)">&#xe5c8</div>
    <div id="teamImages">
        {% for image in team["images"] %}
        <div style="background-image:url({{ url_for('static', filename=image['location']) }})" class="teamImage" id="img{{ loop.index0 }}"></div>
        {% endfor %}
    </div>
</div>
{% endif %}

<div class="card">
<h2>Comments</h2>
{% for comment in team["comments"] %}
<p>{{ comment["user"] }}: {{ comment["comment"] }}</p>
{% endfor %}
{% if not team["comments"] %}
<p>No comments :(</p>
{% endif %}
</div>

<div class="card">
<a href="{{ url_for('addTeamImagePage', team=team['number']) }}">Add an image</a>
<a href="{{ url_for('setTeamComment', team=team['number']) }}">Add team comment</a>
</div>

<div class="card">
<h2>Statistics</h2>
<select name="stats" id="stats" onchange="changeStat()">
    {% for key, value in stats.items()%}
    <option value="{{ key }}">{{ keyDisplayNames[key] }}</option>
    {% endfor %}
</select>
{% for key, value in stats.items() %}
<div id="{{ key }}" class="statistic hidden">
<h3>{{ keyDisplayNames[key] }}</h3>
    <ul>
        <li>Mean: {{ value["mean"] }}</li>
        <li>Median: {{ value["median"] }}</li>
        <li>Mode: {{ value["mode"] }}</li>
        <li>Lowest: {{ value["lowestMatch"]["value"] }}{% if value["lowestMatch"]["displayName"]%} in <a href="{{ url_for('renderMatch',matchNum=value['lowestMatch']['matchNumber'],setNum=value['lowestMatch']['setNumber'],compLevel=value['lowestMatch']['compLevel']) }}">{{ value['lowestMatch']['displayName'] }}</a>{% endif %}</li>
        <li>Highest: {{ value["highestMatch"]["value"] }}{% if value["highestMatch"]["displayName"]%} in <a href="{{ url_for('renderMatch',matchNum=value['highestMatch']['matchNumber'],setNum=value['highestMatch']['setNumber'],compLevel=value['highestMatch']['compLevel']) }}">{{ value['highestMatch']['displayName'] }}</a>{% endif %}</li>
    </ul>
</div>
{% endfor %}
</div>

<!--<p>{{ team }}</p>-->

<div class="card">
<h2>Matches</h2>
<ul>
    {% for match in matches %}
    <li>
        <a href="{{ url_for('renderMatch',matchNum=match['matchNumber'],setNum=match['setNumber'],compLevel=match['compLevel']) }}">{{match['displayName']}}</a>
    </li>
    {% endfor %}
</ul>
</div>

{% if team["images"] %}
<script>
    const images = document.getElementById("teamImages");
    let currentImage = 0;
    const numberOfImages = {{ team["images"]|length }} - 1;

    const options = {
        root: null,
        rootMargin: "0px",
        scrollMargin: "0px",
        threshold: 0.7,
    };

    

    let imageList = [];
    for (let i = 0; i < numberOfImages+1; i++) {
        imageList.push(document.getElementById("img"+i));
    }
    //console.log(imageList);

    const callback = (entries, observer) => {
        entries.forEach((entry) =>{
            currentImage = imageList.indexOf(entry.target);
            //console.log("detected a change: "+currentImage);
        });
    }

    addEventListener("DOMContentLoaded", (event) => {
        images.scrollLeft = 0;
        currentImage = 0;
    })

    function changeImage(next) {
        if (next && currentImage < numberOfImages){
            currentImage += 1;
        } else if (!next && currentImage > 0){
            currentImage -= 1;
        }

        //console.log("current image: "+currentImage);
        document.getElementById("img"+currentImage).scrollIntoView({behavior:"smooth"});
    }

    const observer = new IntersectionObserver(callback, options);
    for (i = imageList.length-1; i >= 0; i--){
        observer.observe(imageList[i]);
    }
</script>
{% endif %}

<script>
    const dropdown = document.getElementById("stats")

    function changeStat(){
        var stat = dropdown.value;
        var listItem = document.getElementById(stat);
        listItem.classList.remove("hidden");
        var activeItems = document.getElementsByClassName("active");
        for (i=0; i < activeItems.length; i++){
            var activeItem = activeItems[i]
            activeItem.classList.remove("active");
            activeItem.classList.add("hidden");
        }
        listItem.classList.add("active");
    }

    addEventListener("DOMContentLoaded", changeStat())
</script>

{% endblock %}