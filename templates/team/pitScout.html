{% extends 'base.html' %}

{% block head %}
<link rel="preload" href="{{ url_for('static', filename='stylesheets/index.css') }}" as="style">
<link rel="stylesheet" href="{{ url_for('static', filename='stylesheets/index.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='stylesheets/pitScout.css') }}">
{% endblock %}

{% block title %}NerdScout{% endblock %}

{% block content %}
{% set previousPage = "javascript:history.back()" %}
{% include 'backButton.html' %}

    <div class="card">
        <label for="team">Team Number:</label>
        <input type="number" id="team" name="team" {% if team %}value="{{team}}"{%endif%}/>
    </div>
    <div class="card">
        <label for="battery">How many batteries/battery chargers do they have?</label>
        <input type="text" id="battery" name="battery"/>
    </div>
    <div class="card">
        <p>Are their bumpers open or closed?</p>
        <div>
            <div>
                <input type="checkbox" id="bumper-closed" name="bumper-closed"> <label for="bumper-closed">Closed</label>
            </div>
            <div>
                <input type="checkbox" id="bumper-open" name="bumper-open"> <label for="bumper-open">Open</label>
            </div>
        </div>
    </div>
    <div class="card">
        <p>What side do they shoot out of?</p>
        <div>
            <div>
                <input type="checkbox" id="shooting-same" name="shooting-same"> <label for="shooting-same">Shooting on same as intake</label>
            </div>
            <div>
                <input type="checkbox" id="shooting-opposite" name="shooting-opposite"> <label for="shooting-opposite">Shooting on opposite as intake</label>
            </div>
        </div>
    </div>
    <div class="card">
        <p>What drivebase do they use?</p>
        <div>
            <div>
                <input type="checkbox" id="drivetrain-swerve" name="drivetrain-swerve"> <label for="drivetrain-swerve">Swerve</label>
            </div>
            <div>
                <input type="checkbox" id="drivetrain-tank" name="drivetrain-tank"> <label for="drivetrain-tank">Tank</label>
            </div>
            <div>
                <input type="checkbox" id="drivetrain-other" name="drivetrain-other" onclick="showOtherInput1()"> <label for="drivetrain-other">Other</label><br>
                <input type="text" id="drivetrain-other-input" style="display:none;">
            </div>
        </div>
    </div>
    <div class="card">
        <p>What programming language(s) do they use?</p>
        <div>
            <div>
                <input type="checkbox" id="language-java" name="language-java"> <label for="language-java">Java</label>
            </div>
            <div>
                <input type="checkbox" id="language-cpp" name="language-cpp"> <label for="language-cpp">C++</label>
            </div>
            <div>
                <input type="checkbox" id="language-python" name="language-python"> <label for="language-python">Python</label>
            </div>
            <div>
                <input type="checkbox" id="language-labview" name="language-labview"> <label for="language-labview">LabView</label>
            </div>
            <div>
                <input type="checkbox" id="language-other" name="language-other" onclick="showOtherInput2()"> <label for="language-other">Other</label><br>
                <input type="text" id="language-other-input" style="display:none;">
            </div>
        </div>
    </div>
    <div class="card">
        <label for="camera">Do they CURRENTLY have a camera on their robot? If so, what for? Do they have auto aim?</label><br>
        <input type="text" id="camera" name="camera">
    </div>
    <div class="card">
        <p>What can they realistically do during auto?</p>
        <div>
            {% for capability in autoCapabilities %}
            <div>
                <input type="checkbox" id="{{capability[1]}}" name="{{capability[1]}}"> <label for="{{capability[1]}}">{{capability[0]}}</label>
            </div>
            {% endfor %}
        </div>
    </div>
    <div class="card">
        <p>What can they realistically do during teleop?</p>
        <div>
            {% for capability in teleCapabilities %}
            <div>
                <input type="checkbox" id="{{capability[1]}}" name="{{capability[1]}}"> <label for="{{capability[1]}}">{{capability[0]}}</label>
            </div>
            {% endfor %}
        </div>
    </div>
    <div class="card">
        <p>climb</p>
        <div>
            {% for capability in climbCapabilities %}
            <div>
                <input type="checkbox" id="{{capability[1]}}" name="{{capability[1]}}"> <label for="{{capability[1]}}">{{capability[0]}}</label>
            </div>
            {% endfor %}
        </div>
        <div>
            <label for="climb-time">How long does their climb usually take?</label><br>
            <input type="text" id="climb-time" name="climb-time"/>
        </div>
    </div>
    <div class="card">
        <label for="hold">How much fuel can they intake and hold at a time? </label><br>
        <input type="number" id="hold" name="hold" min="0"/>
    </div>
    <div class="card">
        <label for="cycles">How many cycles do they usually get per game?</label><br>
        <input type="text" id="cycles" name="cycles"/>
    </div>
    <div class="card">
        <label for="weight">What is their robot weight (without batteries and bumpers) (lbs)? </label><br>
        <input type="number" id="weight" name="weight"/>
    </div>
    <div class="card"> 
        <label for="special">Anything special we should know about their robot? </label><br>
        <input type="text" id="special" name="special"/>
    </div>
    <div class="card">
        <label for="experience">How experienced are their drivers?</label><br>
        <input type="text" id="experience" name="experience"/>
    </div>
    <div class="card">
        <label for="organize">Observe for yourself and don't ask a question: how organized is their pit? </label><br>
        <input type="text" id="organize" name="organize"/>
    </div>
    <div class="card">
        <label for="comment">Any other comments? </label><br>
        <input type="text" id="comment" name="comment"/>
    </div>
</div>

<button onclick="submitData()" class="card">Submit</button>

<script>
    function getCheckbox(id){
        return document.getElementById(id).checked;
    }
    function getValue(id,checkEmpty=true){
        let value = document.getElementById(id).value;
        let valueEmpty = (checkEmpty&&(value===""));
        isEmpty ||= valueEmpty;
        if (valueEmpty){
            emptyList.push(id);
        }
        return value;
    }

    const otherInput1Box = document.getElementById("drivetrain-other-input");
    const otherCheck1 = document.getElementById("drivetrain-other");

    const otherInput2Box = document.getElementById("language-other-input");
    const otherCheck2 = document.getElementById("language-other");

    function showOtherInput1(){
        if (otherCheck1.checked){
            otherInput1Box.style = "display:inline;";
        } else{
            otherInput1Box.style = "display:none";
            otherInput1Box.value = "";
        }
    }

    function showOtherInput2(){
        if (otherCheck2.checked){
            otherInput2Box.style = "display:inline;";
        } else{
            otherInput2Box.style = "display:none";
            otherInput2Box.value = "";
        }
    }

    var isEmpty = false;
    var emptyList = [];

    function submitData(){
        isEmpty=false;
        emptyList = []

        let team = getValue("team");
        console.log(team);

        let rawData = {
            "battery": getValue("battery"),
            "drivebase": {
                "swerve": getCheckbox("drivetrain-swerve"),
                "tank": getCheckbox("drivetrain-tank"),
                "other": getValue("drivetrain-other-input",false)
            },
            "bumpers": {
                "closed": getCheckbox("bumper-closed"),
                "open": getCheckbox("bumper-open"),
            },
            "shootside": {
                "shooting-same": getCheckbox("shooting-same"),
                "shooting-opposite": getCheckbox("shooting-opposite"),
            },
            "languages": {
                "java": getCheckbox("language-java"),
                "c++": getCheckbox("language-cpp"),
                "python": getCheckbox("language-python"),
                "labview": getCheckbox("language-labview"),
                "other": getValue("language-other-input",false)
            },
            "camera": getValue("camera"),
            "auto": {
                {% for capability in autoCapabilities %}
                "{{capability[1]}}":getCheckbox("{{capability[1]}}"),
                {% endfor %}
                "climb":{% for n in ('center','side') %}getCheckbox("auto-climb1-{{n}}")||{% endfor %}false
            },
            "tele": {
                {% for capability in teleCapabilities %}
                "{{capability[1]}}":getCheckbox("{{capability[1]}}"),
                {% endfor %}
            },
            "climb": {
                {% for capability in climbCapabilities %}
                "{{capability[1]}}":getCheckbox("{{capability[1]}}"),
                {% endfor %}
                "climb-time": getValue("climb-time")
            },
            "hold":getValue("hold"),
            "cycles":getValue("cycles"),
            "weight":getValue("weight"),
            "special":getValue("special",false),
            "organization":getValue("organize"),
            "comment":getValue("comment",false),
            {% for i in range(1,4)%}
            "climb{{i}}":{% for n in ('center','side') %}getCheckbox("tele-climb{{i}}-{{n}}")||{% endfor %}false,
            {% endfor %}
        }

        if (isEmpty) {
            alert("Please fill out every field. Missing: "+emptyList.join(", "));
            return;
        }

        console.log(rawData);

        let data = JSON.stringify(rawData);
        console.log(data);

        fetch(window.location.href, {
            method: "POST",
            body: data,
            headers: {
                "Content-type": "application/json; charset=UTF-8",
                "team":team
            }
            }).then(response =>{
                if (response.ok){
                    if (confirm('Submitted! Redirect to image submision page?')){
                        window.location.href="{{url_for('addTeamImagePage')}}?team="+team;
                    } else if (confirm("Redirect to team page?")){
                        window.location.href="{{url_for('teamPage')}}?team="+team;
                    };
                } else {
                    alert("Error submitting!");
                }
        });
    }
</script>
{% endblock %}