{% extends 'base.html' %}

{% block head %}
<link rel="preload" href="{{ url_for('static', filename='stylesheets/index.css') }}" as="style">
<link rel="stylesheet" href="{{ url_for('static', filename='stylesheets/index.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='stylesheets/pitScout.css') }}">
{% endblock %}

{% block title %}NerdScout{% endblock %}

{% block content %}

    <div class="card">
        <label for="team">Team Number:</label>
        <input type="number" id="team" name="team" {% if team %}value="{{team}}"{%endif%}/>
    </div>

    <div class="card">
        <label for="drivebase">What drivebase do they use?</label>
        <input type="text" id="drivebase" name="drivebase"/>
    </div>
    <div class="card">
        <p>What programming language(s) do they use?</p>
        <div>
            <div>
                <input type="checkbox" id="language-java" name="language-java"> <label for="language-java">Java</label>
            </div>
            <div>
                <input type="checkbox" id="language-cpp" name="language-cpp"> <label for="language-cpp">C++</label>
            </div>
            <div>
                <input type="checkbox" id="language-python" name="language-python"> <label for="language-python">Python</label>
            </div>
            <div>
                <input type="checkbox" id="language-labview" name="language-labview"> <label for="language-labview">LabView</label>
            </div>
            <div>
                <input type="checkbox" id="language-other" name="language-other" onclick="showOtherInput()"> <label for="language-labview">Other</label><br>
                <input type="text" id="language-other-input" style="display:none;">
            </div>
        </div>
    </div>
    <div class="card">
        <label for="camera">Do they CURRENTLY have a camera on their robot? If so, describe:</label>
        <input type="text" id="camera" name="camera">
    </div>
    <div class="card">
        <p>What can they realistically do during auto?</p>
        <div>
            <div>
                <input type="checkbox" id="auto-leave" name="auto-leave"> <label for="auto-leave">Leave the starting area</label>
            </div>
            <div>
                <input type="checkbox" id="auto-algae" name="auto-algae"> <label for="auto-algae">Remove algae from reef</label>
            </div>
            {% for level in ["L1","L2","L3","L4"] %}
            <div>
                <input type="checkbox" id="auto-reef-{{level}}" name="auto-reef-{{level}}"> <label for="auto-reef-{{level}}">Score on reef {{level}}</label>
            </div>
            {%endfor%}
            <div>
                <input type="checkbox" id="auto-processor" name="auto-processor"> <label for="auto-processor">Score on processor</label>
            </div>
            <div>
                <input type="checkbox" id="auto-net" name="auto-net"> <label for="auto-net">Score on net</label>
            </div>
        </div>
    </div>
    <div class="card">
        <p>What can they realistically do during teleop?</p>
        <div>
            <div>
                <input type="checkbox" id="tele-algae" name="tele-algae"> <label for="tele-algae">Remove algae from reef</label>
            </div>
            {% for level in ["L1","L2","L3","L4"] %}
            <div>
                <input type="checkbox" id="tele-reef-{{level}}" name="tele-reef-{{level}}"> <label for="tele-reef-{{level}}">Score on reef {{level}}</label>
            </div>
            {%endfor%}
            <div>
                <input type="checkbox" id="tele-processor" name="tele-processor"> <label for="tele-processor">Score on processor</label>
            </div>
            <div>
                <input type="checkbox" id="tele-net" name="tele-net"> <label for="tele-net">Score on net</label>
            </div>
            <div>
                <input type="checkbox" id="tele-park" name="tele-park"> <label for="tele-park">Park during endgame</label>
            </div>
            <div>
                <input type="checkbox" id="tele-shallow" name="tele-shallow"> <label for="tele-shallow">Shallow cage during endgame</label>
            </div>
            <div>
                <input type="checkbox" id="tele-deep" name="tele-deep"> <label for="tele-deep">Deep cage during endgame</label>
            </div>
        </div>
    </div>
    <div class="card">
        <label for="role">What role does their robot serve? </label><br>
        <input type="text" id="role" name="role"/>
    </div>
    <div class="card">
        <label for="weight">What is their robot weight (without batteries and bumpers) (lbs)? </label><br>
        <input type="number" id="weight" name="weight"/>
    </div>
    <div class="card"> 
        <label for="special">Anything special we should know about their robot? </label><br>
        <input type="text" id="special" name="special"/>
    </div>
    <div class="card">
        <label for="organize">Observe for yourself and don't ask a question: how organized is their pit? </label><br>
        <input type="text" id="organize" name="organize"/>
    </div>
    <div class="card">
        <label for="comment">Any other comments? </label><br>
        <input type="text" id="comment" name="comment"/>
    </div>
</div>

<button onclick="submitData()" class="card">Submit</button>

<script>
    function getCheckbox(id){
        return document.getElementById(id).checked;
    }
    function getValue(id,checkEmpty=true){
        let value = document.getElementById(id).value;
        let valueEmpty = (checkEmpty&&(value===""));
        isEmpty ||= valueEmpty;
        if (valueEmpty){
            emptyList.push(id);
        }
        return value;
    }

    var otherInputBox = document.getElementById("language-other-input");
    var otherCheck = document.getElementById("language-other");

    function showOtherInput(){
        console.log(otherCheck.checked);
        if (otherCheck.checked){
            otherInputBox.style = "display:inline;";
        } else{
            otherInputBox.style = "display:none";
            otherInputBox.value = "";
        }
    }

    var isEmpty = false;
    var emptyList = [];

    function submitData(){
        isEmpty=false;
        emptyList = []

        let team = getValue("team");
        console.log(team);

        let rawData = {
            "drivebase": getValue("drivebase"),
            "languages": {
                "java": getCheckbox("language-java"),
                "c++": getCheckbox("language-cpp"),
                "python": getCheckbox("language-python"),
                "labview": getCheckbox("language-labview"),
                "other": getValue("language-other-input",false)
            },
            "camera": getValue("camera"),
            "auto": {
                "leave":getCheckbox("auto-leave"),
                "removeAlgae":getCheckbox("auto-algae"),
                "reef":[
                    getCheckbox("auto-reef-L1"),
                    getCheckbox("auto-reef-L2"),
                    getCheckbox("auto-reef-L3"),
                    getCheckbox("auto-reef-L4"),
                ],
                "processor":getCheckbox("auto-processor"),
                "net":getCheckbox("auto-net")
            },
            "tele": {
                "removeAlgae":getCheckbox("tele-algae"),
                "reef":[
                    getCheckbox("tele-reef-L1"),
                    getCheckbox("tele-reef-L2"),
                    getCheckbox("tele-reef-L3"),
                    getCheckbox("tele-reef-L4"),
                ],
                "processor":getCheckbox("tele-processor"),
                "net":getCheckbox("tele-net"),
                "park":getCheckbox("tele-park"),
                "shallow":getCheckbox("tele-shallow"),
                "deep":getCheckbox("tele-deep")
            },
            "role":getValue("role"),
            "weight":getValue("weight"),
            "special":getValue("special",false),
            "organization":getValue("organize"),
            "comment":getValue("comment",false)
        }

        if (isEmpty) {
            alert("Please fill out every field. Missing: "+emptyList.join(", "));
            return;
        }

        console.log(rawData);

        let data = JSON.stringify(rawData);

        
        fetch(window.location.href, {
            method: "POST",
            body: data,
            headers: {
                "Content-type": "application/json; charset=UTF-8",
                "team":team
            }
            }).then(response =>{
                if (response.ok){
                    if (confirm('Submitted! Redirect to team page?')){
                        window.location.href="{{url_for('teamPage')}}?team="+team;
                    };
                } else {
                    alert("Error submitting!");
                }
        });
    }
</script>
{% endblock %}