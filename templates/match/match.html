{% extends 'base.html' %}

{% block head %}
<script src="{{ url_for('static', filename='javascript/match.js') }}" defer></script>
<link rel="preload" href="{{ url_for('static', filename='stylesheets/match.css') }}" as="style">
<link rel="stylesheet" href="{{ url_for('static', filename='stylesheets/match.css') }}">
{% endblock %}

{% block title %}Match Viewer{% endblock %}

{% block content %}
{% set previousPage = url_for("renderMatch") %}
<div class="navbuttons">
    {% include 'backButton.html' %}
    {% if nextMatch %}
    <a href="{{ url_for('renderMatch',matchNum=results['matchNumber']+1,compLevel=results['compLevel'],setNum=results['setNumber']) }}" id="nextButtonLink">
        <div id="nextButton" class="card">
            <span id="nextButtonContents"><span style="white-space:pre;">Next </span><span class="icon" style="font-size: 20px;">arrow_forward_ios</span></span>
        </div>
    </a>
    {% endif %}
</div>

<div class="select-div">
    {% for teamSection in teams %}
    {% set color = 'red' if loop.index == 1 else 'blue' %}
    <div class="{{color}}-div">
    {% for team in teamSection %}
    <button onclick="set_team('{{color}}{{loop.index}}')" class="{{color}}Button {% if team['hasData']%}scored{% endif %}">{{team['teamNumber']}}</button>
    {% endfor %}
    </div>
    {% endfor%}
</div>

{% for teamSection in teams %}
<div class="center-horizontal">
{% set color = 'red' if loop.index == 1 else 'blue' %}
<div class="{{color}}-table">
{% for team in teamSection %}
<div class="team-{{ loop.index }} team team-{{color}}{{loop.index}}">
    <div class="headLine">

    </div>
    <div class="teamNumberWrapper">
        <a href="{{ url_for('teamPage',team=team['teamNumber']) }}" class="teamNumber">Team Number {{ team['teamNumber'] }}</a>
    </div>
    {% if team["hasData"] %}
    <select id="results-select-{{ color }}-{{ loop.index }}" onclick="set_visible(get_results_div('{{color}}','{{loop.index}}'),'results-select-{{ color }}-{{ loop.index }}')">
        {% for result in team['results'] %}
        <option value="{{ loop.index }}" {% if loop.last %} selected {% endif %}>Revision {{loop.index}} ({{result['scout']}})</option>
        {% endfor %}
    </select>
    <div class="results-div">
    {% for result in team['results'] %}
    <div class="match-data revision-{{ loop.index }} {% if not loop.last %} hidden {% endif %}">

        <div class="scoredBy">
            <p>Scored by: {{result['scout']}}</p>
        </div>

        
        <div class="pos-div">
            <div>
                <h3>Start Position: {{ result["startPos"] }}</h3>
            </div>
            <img src="{{ url_for('static', filename='images/matchDisplay/pos'~result['startPos']+'.svg') }}" class="startPosImg">
        </div>

        <div>
            
            <div class="section-title">
                <h2>Auto</h2>
            </div>
            
            <div class="leaveBlock">
                <h3>Leave:</h3>
                {% if result["autoLeave"] %}
                <img src="{{ url_for('static', filename='images/matchDisplay/True.svg') }}" class="startPosImg">
                {% else %}
                <img src="{{ url_for('static', filename='images/matchDisplay/False.svg') }}" class="startPosImg">           
                {% endif %}
            </div>

            <div class="reef-div">
                <div class="table">
                    <div class="row">
                        <div class="cell5 cell"><b>Coral</b></div>
                    </div>
                    <div class="row">
                        <div class="miss cell"><b>Miss</b></div> 
                        <div class="cell"><b>L1</b></div> 
                        <div class="cell"><b>L2</b></div> 
                        <div class="cell"><b>L3</b></div> 
                        <div class="cell"><b>L4</b></div>                    
                    </div>
                    <div class="row">
                        <div class="cell miss">{{ result["autoReefMiss"] }}</div> 
                        <div class="cell">{{ result["autoReef"][0] }}</div> 
                        <div class="cell">{{ result["autoReef"][1] }}</div> 
                        <div class="cell">{{ result["autoReef"][2] }}</div> 
                        <div class="cell">{{ result["autoReef"][3] }}</div>                    
                    </div>
                </div>
            </div>
            
            <div class="algaeDiv">
                <div class="table">
                    <div class="row">
                        <div class="cell2 cell"><b>Processor</b></div>
                        <div class="cell2 cell"><b>Net</b></div>
                    </div>
                    <div class="row">
                        <div class="cell miss">{{ result["autoProcessorMiss"] }}</div>
                        <div class="cell">{{ result["autoProcessor"] }}</div>
                        <div class="cell miss">{{ result["autoNetMiss"] }}</div>
                        <div class="cell">{{ result["autoNet"] }}</div>
                    </div>
                </div>
            </div>
        </div>

        <div>

            <div class="section-title">
                <h2>Teleop</h2>
            </div>

            <div class="reef-div">
                <div class="table">
                    <div class="row">
                        <div class="cell5 cell"><b>Coral</b></div>
                    </div>
                    <div class="row">
                        <div class="miss cell"><b>Miss</b></div> 
                        <div class="cell"><b>L1</b></div> 
                        <div class="cell"><b>L2</b></div> 
                        <div class="cell"><b>L3</b></div> 
                        <div class="cell"><b>L4</b></div>                    
                    </div>
                    <div class="row">
                        <div class="cell miss">{{ result["teleReefMiss"] }}</div> 
                        <div class="cell">{{ result["teleReef"][0] }}</div> 
                        <div class="cell">{{ result["teleReef"][1] }}</div> 
                        <div class="cell">{{ result["teleReef"][2] }}</div> 
                        <div class="cell">{{ result["teleReef"][3] }}</div>                    
                    </div>
                </div>
            </div>
            
            <div class="algaeDiv">
                <div class="table">
                    <div class="row">
                        <div class="cell2 cell"><b>Processor</b></div>
                        <div class="cell2 cell"><b>Net</b></div>
                    </div>
                    <div class="row">
                        <div class="cell miss">{{ result["teleProcessorMiss"] }}</div>
                        <div class="cell">{{ result["teleProcessor"] }}</div>
                        <div class="cell miss">{{ result["teleNetMiss"] }}</div>
                        <div class="cell">{{ result["teleNet"] }}</div>
                    </div>
                </div>
            </div>

        </div>

        <div>
            <div class="section-title">
                <h3>Endgame</h3> 
            </div>

            <div class="endPosDiv">
                <div class="table">
                    <div class="row">
                        <div class="cell cell3"><b>Tried End Pos</b></div>
                        <div class="cell cell3"><b>Succeeded</b></div>
                    </div>
                    <div class="row">
                        <div class="cell cell3"><p>{{ (['None','Park','Shallow cage','Deep cage'])[result["attemptedEndPos"]] }}</p></div>
                        <div class="cell cell3">
                            {% if result['endPosSuccess'] %}
                            <img src="{{ url_for('static', filename='images/matchDisplay/True.svg') }}" class="startPosImg">
                            {% else %}
                            <img src="{{ url_for('static', filename='images/matchDisplay/False.svg') }}" class="startPosImg">           
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="foulDiv">
                <div clas="table">
                    <div class="row">
                        <div class="cell cell2"><b>Minor:</b></div>
                        <div class="cell cell2"><b>Major:</b></div>
                    </div>
                    <div class="row">
                        <div class="cell cell2">
                            <p>{{ result["minorFouls"] }}</p>    
                        </div>
                        <div class="cell cell2">
                            <p>{{ result["majorFouls"] }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <h3>Comment:</h3>
            {% if result["comment"] %}
            {% if result["cannedComments"] %}
            <ul>
                {% for cannedComment in result["cannedComments"] %}
                <li>{{cannedComment}}</li>
                {% endfor %}
            </ul>
            {% endif %}
            <p>{{ result["comment"] }}</p>
            {% elif result["cannedComments"] %}
            <ul>
                {% for cannedComment in result["cannedComments"] %}
                <li>{{cannedComment}}</li>
                {% endfor %}
            </ul>
            {% else %}
            <p>No comment.</p>
            {% endif %}
            
        </div>
    </div>
    {% endfor %}
    </div>
    {% else %}
    <p>No data</p>
    <a href="{{ url_for('submitScorePage', team=team['teamNumber'], compLevel=results['compLevel'], matchNumber=results['matchNumber'], setNumber=results['setNumber'], robotStation=color+(loop.index|string)) }}">Scout this team</a>
    {% endif %}
    <br>
</div>
{% endfor %}
</div>
</div>
<!-- {% if loop.index == 1 %}<div class="spacer"></div>{% endif %} -->
{% endfor %}

<div id="remove"><p>Press on one of the teams to see their results</p></div>
<div class="score-breakdown" id="score-breakdown">
<p>Score breakdown</p>
<div class="score-div colorless">
    <div class="number">
        <p>Team</p>
    </div>
    <div class="score">
        <p>Score</p>
    </div>
</div>
{% for teamSection in teams %}
{% set color = 'red' if loop.index == 1 else 'blue' %}
<div class="{{color}}-score">
{% for team in teamSection %}
<div class="score-div">
    <div class="number">
        <p>{{team['teamNumber']}}</p>
    </div>
    <div class="score">
        {% if team["hasData"] %}
        <p>{{ team['results'][-1]['score'] }}</p>
        {% else %}
        <p>None</p>
        {% endif %}
    </div>
</div>
{% endfor %}
</div>
{% endfor %}
</div>
{% endblock %}