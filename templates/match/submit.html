{% extends 'base.html' %}

{% block head %}
<script src="{{ url_for('static', filename='javascript/submit.js') }}" defer></script>
<link rel="preload" href="{{ url_for('static', filename='stylesheets/submit.css') }}" as="style">
<link rel="stylesheet" href="{{ url_for('static', filename='stylesheets/submit.css') }}">
<script>
    function redirect_to_match(){
        window.location.href = "{{ url_for('renderMatch',matchNum=matchVal,compLevel=compLvl,setNum=setVal) | safe}}";
    }
</script>
{% endblock %}

{% block title %} Scouting: Team {{teamNum}} {% endblock %}

{% block content %}

<div class="topbar">
    <div class="topbarTop">
        <h1>NOW SCOUTING</h1>
    </div>
    <div class="topbarBottom"> 
        <div>
            <a href="{{url_for('renderMatch',matchNum=match,compLevel=compLvl,setNum=setVal)}}">Match: <br> {{compLvl}} {{match}} </a>
        </div>
        <div>
            <p>Team:<br>{{teamNum}}</p>
        </div>
        <div>
            <p>Station:<br>{{rbtStat}}</p>
        </div>
        <!-- <p>Match Number: {{match}} {{compLvl}} || Team: {{teamNum}} || Station Number: {{rbtStat}}</p> -->
    </div>
</div>

<div class="main">

    {# TODO: Make this a shift #}
    
    
    <div id="game" class="column">
        <div id="shift-select">
            {% for n in range(-1,8) %}
            <button {% if loop.first %}class="selected"{% endif %} data-index="{{n}}" onclick="setScoringPeriod({{n}})">{{ ("Pregame","Auto","Transition","Shift 1","Shift 2","Shift 3","Shift 4","Endgame","Postgame")[n+1] }}</button>
            {% endfor %}
        </div>
        <div class="main-input shift-0" id="main-input">
            <div class="active">
                <div class="row">
                    <button id="timer-button" onclick="toggleTimer()">Start timer</button>
                </div>
                <input type="number" id="time" min="0" value="0">
                <div class="counter specialCounter">
                    <button class="minus" onclick="incrementCounter('scored',false,10)">-10</button>
                    <button class="minus" onclick="incrementCounter('scored',false,5)">-5</button>
                    <button class="minus" onclick="incrementCounter('scored',false)">-1</button>
                    <input type="number" id="scored" min="0" value="0">
                    <button class="plus" onclick="incrementCounter('scored',true)">+1</button>
                    <button class="plus" onclick="incrementCounter('scored',true,5)">+5</button>
                    <button class="plus" onclick="incrementCounter('scored',true,10)">+10</button>
                </div>
                <div class="counter specialCounter">
                    <button class="minus" onclick="incrementCounter('missed',false,10)">-10</button>
                    <button class="minus" onclick="incrementCounter('missed',false,5)">-5</button>
                    <button class="minus" onclick="incrementCounter('missed',false)">-1</button>
                    <input class="miss" type="number" id="missed" min="0" value="0">
                    <button class="plus" onclick="incrementCounter('missed',true)">+1</button>
                    <button class="plus" onclick="incrementCounter('missed',true,5)">+5</button>
                    <button class="plus" onclick="incrementCounter('missed',true,10)">+10</button>
                </div>
                <div class="row">
                    <button class="addSP" onclick="submitScoringPeriod()">Add scoring period</button>
                </div>
                <table id="score-table">
                    <tr class="headers">
                        <th><img width="50px" height="50px" src="{{ url_for('static', filename='images/rebuiltMatchDisplay/Time.svg') }}"></th>
                        <th><img width="50px" height="50px" src="{{ url_for('static', filename='images/rebuiltMatchDisplay/Scored.svg') }}"></th>
                        <th><img width="50px" height="50px" src="{{ url_for('static', filename='images/rebuiltMatchDisplay/Missed.svg') }}"></th>
                    </tr>
                </table>
            </div>
            <div class="shift-thing shift-auto">
                <div class="row">
                    <label class="toggle-btn-wrapper">
                        <div class="toggle-btn">
                            <p>Depot Intake</p>
                            <input type="checkbox" id="autoDepot">
                        </div>
                    </label>

                    <label class="toggle-btn-wrapper">
                        <div class="toggle-btn">
                            <p>Over Bump</p>
                            <input type="checkbox" id="autoBump">
                        </div>
                    </label>
                    
                    <label class="toggle-btn-wrapper">
                        <div class="toggle-btn">
                            <p>Under Trench</p>
                            <input type="checkbox" id="autoTrench">
                        </div>
                    </label>
                </div>
                <div class="row">
                    <label class="toggle-btn-wrapper">
                        <div class="toggle-btn">
                            <p>Neutral Zone Intake</p>
                            <input type="checkbox" id="autoNeutralIntake">
                        </div>
                    </label>
                
            
                    <label class="toggle-btn-wrapper">
                        <div class="toggle-btn">
                            <p>Scored AFTER Intaking</p>
                            <input type="checkbox" id="autoAttemptedSecondScore">
                        </div>
                    </label>

                    <label class="toggle-btn-wrapper">
                        <div class="toggle-btn">
                            <p>Score Success</p>
                            <input type="checkbox" id="autoSucceededSecondScore">
                        </div>
                    </label>
                </div>
                
                <div class="row">
                    <label class="toggle-btn-wrapper">
                        <div class="toggle-btn">
                            <p>Climb attempt</p>
                            <input type="checkbox" id="autoClimbAttempted">
                        </div>
                    </label>
                
                    <label class="toggle-btn-wrapper">
                        <div class="toggle-btn">
                            <p>Climb success</p>
                            <input type="checkbox" id="autoClimbSuccess">
                        </div>
                    </label>

                    <label class="toggle-btn-wrapper">
                        <div class="toggle-btn">
                            <p>Feed FROM outpost</p>
                            <input type="checkbox" id="autoOutpostFeed">
                        </div>
                    </label>
                </div>
                
                <div class="row">
                    <label class="toggle-btn-wrapper">
                        <div class="toggle-btn">
                            <p>Feed INTO outpost</p>
                            <input type="checkbox" id="autoFedToOutpost">
                        </div>
                    </label>
                </div>

            </div>
            {% for n in ["transition","firstActiveShift","secondActiveShift","firstInactiveShift","secondInactiveShift","endgame"] %}
            <div class="shift-thing shift-{{n}}">
                <p>shift {{n}}</p>
                <div class="row">
                {% if "Inactive" in n%}
                    <label class="toggle-btn-wrapper">
                        <div class="toggle-btn">
                            <p>Scored on purpose</p>
                            <input type="checkbox" id="{{n}}Scored">
                        </div>
                    </label>
                    {% endif %}
                    <label class="toggle-btn-wrapper">
                        <div class="toggle-btn">
                            <p>Fed</p>
                            <input type="checkbox" id="{{n}}Fed">
                        </div>
                    </label>
                    <label class="toggle-btn-wrapper">
                        <div class="toggle-btn">
                            <p>Played Defense</p>
                            <input type="checkbox" id="{{n}}Defense">
                        </div>
                    </label>
                </div>
                {% if "transition"==n %}
                    {# change this into a switch #}
                    <div class="column">
                        <h2>Won first shift?</h2>
                        <label class="switch">
                            <input type="checkbox" id="firstShift"/>
                            <span></span>
                        </label>
                        {# <div class="row">
                            <div class="toggle-btn toggleShift">
                                <img src="{{ url_for('static', filename='images/rebuiltMatchDisplay/Scored.svg')}}">
                                <input type="checkbox" id="wonFirstShift">
                            </div>
                            <div class="toggle-btn toggleShift">
                                <img src="{{ url_for('static', filename='images/rebuiltMatchDisplay/Missed.svg')}}">
                                <input type="checkbox" id="lostFirstShift">
                            </div>
                        </div> #}
                    </div>

                    {# <div class="row">
                        <label class="toggle-btn-wrapper">
                            <div class="toggle-btn">
                                <b>Won first Shift?</b>
                                <input type="checkbox" id="firstShift">
                            </div>
                        </label>
                    </div> #}
                {% endif %}
                
            </div>
            {% endfor %}
            <div class="shift-thing shift-pregame">
                <div class="column">
                    <h1>Pre-Game</h1>
                    
                    <div class="row">
                        <div class="column">
                            <label for="startposinput">Starting position</label>
                            <div class="field">
                                <div id="fieldHighlight"></div>
                                {% for n in range(10)%}
                                <img class="fieldImg" src="{{ url_for('static', filename='images/rebuiltMatchDisplay/Field/False/'+ ('Red' if 'red' in rbtStat else 'Blue') +'/(' + (n+1)|string + ').png')}}">
                                {% endfor %}
                            </div>
                        <input type="range" min="0" max="9" step="1" val="5" id="startposinput" oninput="moveImage()">
                        </div>

                    </div>
                    <div class="row">

                        <div class="counter">
                            <div class="row">
                                <button class="minus" onclick="incrementCounter('preloadFuel',false)">-</button>
                                <input type="number" id="preloadFuel" min="0" max="8" value="0">
                                <button class="plus" onclick="incrementCounter('preloadFuel',true)">+</button>
                            </div>
                            <label for="preloadFuel">Preload fuel</label>
                        </div>

                        <div>
                            
                        </div>
                    </div>

                </div>
            </div>
            <div class="shift-thing shift-postgame">
                <div class="column">
                    <label for="endClimb" id="endPosText">End position:</label>
                    <input type="range" min="0" max="3" step="1" value="1" id="endClimb" oninput="changeText()">
                </div>
                <div class="row">
                    <label class="toggle-btn-wrapper">
                        <div class="toggle-btn">
                            <p>Intake from outpost</p>
                            <input type="checkbox" id="outpostIntake">
                        </div>
                    </label>
                    <label class="toggle-btn-wrapper">
                        <div class="toggle-btn">
                            <p>Intake from ground</p>
                            <input type="checkbox" id="groundIntake">
                        </div>
                    </label>
                    <label class="toggle-btn-wrapper">
                        <div class="toggle-btn">
                            <p>Feed INTO outpost</p>
                            <input type="checkbox" id="fedToOutpost">
                        </div>
                    </label>
                </div>

                <div>
                    <p>Comments</p>
                    <div class="cannedComments">
                        {% for cannedComment in cannedComments%}
                        <button data-text="{{cannedComment}}" id="canned-{{cannedComment}}" onclick="toggleActive('canned-{{cannedComment}}')" class="canned-button">{{cannedComment}}</button>
                        {% endfor %}
                    </div>
                    <textarea id="comments" placeholder="Write comments here..."></textarea>
                </div>
                <button onclick="submitData({{matchVal}}, '{{compLvl}}', {{setVal}}, '{{rbtStat}}')" class="submitButton">Submit</button>
            </div>
        </div>
    </div>


    <div class="row fouls column">
        <div class="row">
            <div class="column">
                <label for="minorFouls">Minor fouls</label>
                <div class="counter row">
                    <button class="minus" onclick="incrementCounter('minorFouls',false)">-</button>
                    <input type="number" id="minorFouls" min="0" value="0">
                    <button class="plus" onclick="incrementCounter('minorFouls',true)">+</button>
                </div>
            </div>
            <div class="column">
                <label for="majorFouls">Major fouls</label>
                <div class="counter row">
                    <button class="minus" onclick="incrementCounter('majorFouls',false)">-</button>
                    <input type="number" id="majorFouls" min="0" value="0">
                    <button class="plus" onclick="incrementCounter('majorFouls',true)">+</button>
                </div>
            </div>
        </div>
        <div id="shift-select2">
            {% for n in range(-1,8) %}
            <button {% if loop.first %}class="selected"{% endif %} data-index="{{n}}" onclick="setScoringPeriod({{n}})">{{ ("Pregame","Auto","Transition","Shift 1","Shift 2","Shift 3","Shift 4","Endgame","Postgame")[n+1] }}</button>
            {% endfor %}
        </div>
    </div>

</div>

<script>
    const slider = document.getElementById("startposinput")
    const fieldHighlight = document.getElementById("fieldHighlight");
    function moveImage(){
        var sliderVal = slider.value;
        fieldHighlight.style.left = (sliderVal*10)+"%";
    }
    moveImage();
</script>

{% endblock %}